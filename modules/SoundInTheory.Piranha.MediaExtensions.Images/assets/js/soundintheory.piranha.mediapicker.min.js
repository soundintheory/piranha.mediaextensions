setTimeout(()=>{piranha.mediapicker=new Vue({el:"#mediamanagerpicker",data:{folderName:"",search:"",listView:!0,typeFilter:null,currentFolderId:null,parentFolderId:null,currentDocumentFolderId:null,parentDocumentFolderId:null,currentImageFolderId:null,parentImageFolderId:null,currentVideoFolderId:null,parentVideoFolderId:null,currentFolderBreadcrumb:null,filter:"",orderBy:"lastModified",direction:"desc",folders:[],filteredFolders:[],items:[],filteredItems:[],folder:{name:null},callback:null,dropzone:null},methods:{toggle:function(){this.listView=!this.listView},load:function(e){var r=this,e=piranha.baseUrl+"manager/api/mediamanager/list"+(e?"/"+e:"")+"/?width=210&height=160";r.typeFilter&&(e+="&filter="+r.typeFilter),fetch(e).then(function(e){return e.json()}).then(function(e){if(r.currentFolderId=e.currentFolderId,r.parentFolderId=e.parentFolderId,r.folders=e.folders,r.items=e.media,r.listView="list"===e.viewMode,r.search="",r.currentFolderBreadcrumb=e.currentFolderBreadcrumb,r.typeFilter)switch(r.typeFilter.toLowerCase()){case"document":r.currentDocumentFolderId=e.currentFolderId,r.parentDocumentFolderId=e.parentFolderId;break;case"image":r.currentImageFolderId=e.currentFolderId,r.parentImageFolderId=e.parentFolderId;break;case"video":r.currentVideoFolderId=e.currentFolderId,r.parentVideoFolderId=e.parentFolderId}r.sortItems()}).catch(function(e){console.log("error:",e)})},getThumbnailUrl:function(e){return null!==e.altVersionUrl?e.altVersionUrl:piranha.baseUrl+"manager/api/media/url/"+e.id+"/210/160"},refresh:function(){piranha.mediapicker.load(piranha.mediapicker.currentFolderId)},open:function(e,r,t){this.search="",this.callback=e,this.typeFilter=r,this.load(t),$("#mediamanagerpicker").modal("show")},openCurrentFolder:function(e,r){this.callback=e,this.typeFilter=r;var t=this.currentFolderId;if(r)switch(r.toLowerCase()){case"document":t=this.currentDocumentFolderId||t;break;case"image":t=this.currentImageFolderId||t;break;case"video":t=this.currentVideoFolderId||t}this.load(t),$("#mediamanagerpicker").modal("show")},onEnter:function(){0===this.filteredItems.length&&1===this.filteredFolders.length&&(this.load(this.filteredFolders[0].id),this.search=""),1===this.filteredItems.length&&0===this.filteredFolders.length&&this.select(this.filteredItems[0])},select:function(e){this.callback(JSON.parse(JSON.stringify(e))),this.callback=null,this.search="",$("#mediamanagerpicker").modal("hide")},savefolder:function(){var r=this;""!==r.folderName&&fetch(piranha.baseUrl+"manager/api/media/folder/save"+(r.typeFilter?"?filter="+r.typeFilter:""),{method:"post",headers:piranha.utils.antiForgeryHeaders(),body:JSON.stringify({parentId:r.currentFolderId,name:r.folderName})}).then(function(e){return e.json()}).then(function(e){"success"===e.status.type&&(r.folderName=null,r.folders=e.folders,r.items=e.media),400!==e.status?piranha.notifications.push(e.status):piranha.notifications.unauthorized()}).catch(function(e){console.log("error:",e)})},toggleDir:function(){"asc"==this.direction?this.direction="desc":this.direction="asc",this.sortItems()},sortItems:function(){var e=[...this.items],r=[...this.folders];const t="name";"asc"==this.direction?(e.sort((e,r)=>e[this.orderBy].localeCompare(r[this.orderBy])),r.sort((e,r)=>e[t].localeCompare(r[t]))):(e.sort((e,r)=>r[this.orderBy].localeCompare(e[this.orderBy])),r.sort((e,r)=>r[t].localeCompare(e[t]))),this.items=e,this.filteredItems=[...e.filter(e=>""===this.filter||e.filename.toLowerCase().includes(this.filter.toLowerCase()))],this.filteredFolders=[...r.filter(e=>""===this.filter||e.name.toLowerCase().includes(this.filter.toLowerCase()))]},filterItems:function(){this.filteredItems=[...this.items.filter(e=>""===this.filter||e.filename.toLowerCase().includes(this.filter.toLowerCase()))],this.filteredFolders=[...this.folders.filter(e=>""===this.filter||e.name.toLowerCase().includes(this.filter.toLowerCase()))]}},watch:{orderBy:function(e){this.sortItems(),this.filterItems()},filter:function(e){this.filterItems()},direction:function(e){this.sortItems()}},mounted:function(){var r=this;piranha.permissions.load(function(){piranha.permissions.media.add&&(r.dropzone=piranha.dropzone.init("#mediamanagerpicker-upload-container"),r.dropzone.on("complete",function(e){"success"===e.status&&setTimeout(function(){r.dropzone.removeFile(e)},3e3)}),r.dropzone.on("queuecomplete",function(){piranha.mediapicker.refresh()}))})}}),$(document).ready(function(){$("#mediamanagerpicker").on("shown.bs.modal",function(){$("#mediamanagerpickerSearch").trigger("focus")})})},400);